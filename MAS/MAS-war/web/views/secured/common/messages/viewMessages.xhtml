<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./../../../../template/WorkspaceTemplate.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <ui:define name="title">
        View Message
    </ui:define>

    <ui:define name="content">
        <h:form>
            <p:panel header="View Messgae">
                <p:tabView orientation="left" value="#{internalMsgController.systemMsgHelpers}" var="msg">
                    <p:tab title="#{msg.sender}" >
                        <ui:repeat value="#{msg.msgs}"  var="message">
                            <p:panel header="#{message.subject}" widgetVar="messagePanel#{message.systemMsgId}" toggleable="true"  style="margin-bottom: 20px;">

                                <p:outputLabel value="#{message.message}" />
                                <p:ajax event="close"  update="messages" />
                                <p:ajax event="toggle" update="messages" />

                                <f:facet name="actions">
                                    <p:outputLabel value="#{message.messageTime}" />
                                    <h:commandLink styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default" onclick="PF('messagePanel#{message.systemMsgId}').close()" >
                                        <h:outputText styleClass="ui-icon ui-icon-close" />
                                    </h:commandLink>
                                    <h:commandLink styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default" onclick="PF('messagePanel#{message.systemMsgId}').toggle()" >
                                        <h:outputText styleClass="ui-icon ui-icon-star" />
                                    </h:commandLink>

                                </f:facet>
                            </p:panel>
                        </ui:repeat>
                    </p:tab>
                </p:tabView>
                <p:dataTable value="#{internalMsgController.userMessages}" rowStyleClass="#{message.deleted ? 'hide' : 'show' }" var="message">
                    <p:column headerText="From">
                        <p:outputLabel value="#{message.messageFrom}"/>
                    </p:column>
                    <p:column headerText="Message">
                        <h:form>
                            <p:outputLabel value="#{message.message} " class="#{message.flaged ? 'flagMessage' : 'unflagMessage'}" />
                            <p:commandButton action="#{navigationController.redirectToViewMessages()}" value="flag"
                                             actionListener="#{internalMsgController.flagMessage(message.message)}" rendered="#{not message.flaged}" icon="ui-icon-star"/>
                            <p:commandButton action="#{navigationController.redirectToViewMessages()}" value="unflag"
                                             actionListener="#{internalMsgController.unFlagMessage(message.message)}" rendered="#{message.flaged}" icon="ui-icon-star"/>
                        </h:form>
                    </p:column>            
                    <p:column headerText="Action">
                        <h:form>
                            <p:commandButton value="delete" action="#{navigationController.redirectToViewMessages()}" actionListener="#{internalMsgController.deleteMessage(message.message)}" update="messages" icon="ui-icon-close">
                                <p:confirm header="Confirmation" message="Are you sure to delete this message?" icon="ui-icon-alert" />
                            </p:commandButton>
                            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                                <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                            </p:confirmDialog>
                        </h:form>
                    </p:column>
                </p:dataTable>
            </p:panel>
        </h:form>
    </ui:define>

</ui:composition>
