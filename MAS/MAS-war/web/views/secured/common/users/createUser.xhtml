<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./../../../../template/WorkspaceTemplate.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:b="botDetectFacelets">

    <ui:define name="title">
        Create new user
    </ui:define>

    <ui:define name="content">
        <h:form id="createUserForm">
            <h:panelGrid columns="2" columnClasses="label, value">

                <h:outputText value="Username"/>
                <p:inputText required="true" requiredMessage="Please enter username" id="username" binding="#{newUsername}"/>
                <h:outputText value="Password"/>
                <p:password required="true" requiredMessage="Please enter password" id="password" binding="#{newPassword}"/>
                <h:outputText value="Name"/>
                <p:inputText required="true" requiredMessage="Please enter name" id="name" binding="#{newName}"/>           
                <h:outputText value="Email"/>
                <p:inputText required="true" requiredMessage="Please enter email" validatorMessage="Invalid email format" id="email" binding="#{newEmail}">
                    <p:ajax update="messages" event="blur" />
                    <f:validateRegex
                        pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
                </p:inputText>
                <h:outputText value="Phone"/>
                <p:inputText binding="#{newPhone}"/>
                <h:outputText value="Address"/>
                <p:inputText binding="#{newAddress}"/>
                <h:outputText value="Department"/>
                <p:inputText binding="#{newDepartment}"/>

                <h:outputText value="Select Roles"/>
                <ui:remove>
                    <p:selectCheckboxMenu id="menu" binding="#{roleNames}" label="Roles"
                                          filter="true" filterMatchMode="startsWith" panelStyle="width:300px"> 
                        <f:selectItems value="#{roleController.roleNameList}" />
                        <p:ajax update ="display"/>
                    </p:selectCheckboxMenu>

                    <p:outputPanel id="display" style="width:250px;">
                        <p:dataList value="#{roleNames.value}" var="roleName" emptyMessage="No permission selected">
                            #{roleName}
                        </p:dataList>
                    </p:outputPanel>
                </ui:remove>


                <p:selectManyMenu id="advanced" value="#{userController.roleList}" converter="roleConverter"
                                  var="role" filter="true" filterMatchMode="contains" showCheckbox="true" style="width:200px;">
                    <f:selectItems value="#{roleController.roles}" var="role" itemLabel="#{role.roleName}" itemValue="#{role}"/>
                    <!--<p:ajax update="display"/>-->
                    <p:column>
                        <h:outputText value="#{role.roleName}"  />
                    </p:column>
                </p:selectManyMenu>

                <ui:remove>
                    <p:commandButton action="#{userController.createUser(newUsername.value, newPassword.value, roleList.value)}" value="Create" update="messages"/>      
                    <p:outputLabel id="display" value="#{roleList.value}" />
                </ui:remove>  

                <p:commandButton action="#{userController.createUser(newUsername.value, newName.value, 
                                           newPassword.value, newEmail.value, newPhone.value, newAddress.value, newDepartment.value)}" 
                                           value="Create" update="messages"/>    

            </h:panelGrid>
        </h:form>
    </ui:define>

</ui:composition>
